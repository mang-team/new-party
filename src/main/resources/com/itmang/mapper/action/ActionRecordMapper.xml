<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itmang.mapper.action.ActionRecordMapper">

    <!-- 分页查询活动记录信息 -->
    <select id="pageGetActionRecordMessage" resultType="com.itmang.pojo.vo.action.PageActionRecordMessageVO">
        select ar.id,ar.action_information_id,a.action_name,ar.state,
               ar.notes,ar.create_time as participationTime
        from action_record ar
        left join action_information a on ar.action_information_id = a.id
        left join user u on ar.user_id = u.id
        <where>
            <if test="actionInformationId != null and actionInformationId != ''">
                and ar.action_information_id = #{actionInformationId}
            </if>
            <if test="actionInformationName != null and actionInformationName != ''">
                and a.action_name like concat('%',#{actionInformationName},'%')
            </if>
            <if test="userId != null and userId != ''">
                and ar.user_id = #{userId}
            </if>
            <if test="userName != null and userName != ''">
                and u.user_name like concat('%',#{userName},'%')
            </if>
            and ar.is_delete = 2
        </where>
        order by ar.create_time desc
    </select>

    <select id="getActionRecordMessageById" resultType="com.itmang.pojo.vo.action.DetailActionRecordMessageVO">
        select a.id, a.action_name, a.activity_content, a.user_id as organizerId, u1.user_name as organizerName,
               a.organizer_phone, a.participant_quantity,
               a.sign_up_start_time, a.sign_up_end_time, a.action_start_time, a.action_end_time,
               a.event_address, a.create_by as createId, u2.user_name as createName,
               ar.create_time as signInTime, ar.state, ar.notes
        from action_record ar
            left join action_information a on ar.action_information_id = a.id
            left join user u1 on a.user_id = u1.id
            left join user u2 on a.create_by = u2.id
        where ar.id = #{id}
    </select>

    <!-- 根据活动记录id修改活动记录表信息 -->
    <update id="modifyActionRecordMessage">
        update action_record
        <set>
            <if test="state != 0">state = #{state},</if>
            <if test="notes != null and notes != ''">notes = #{notes},</if>
            <if test="createBy != null and createBy != ''">create_by = #{createBy},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="updateBy != null and updateBy != ''">update_by = #{updateBy},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
        </set>
        where id = #{id}
    </update>

    <!-- 根据活动记录id删除活动记录 -->
    <update id="deleteActionRecordMessage">
        update action_record
        set is_delete = 1
        where id in
        <foreach collection="idList" item="id" separator="," open="(" close=")">
            #{id}
        </foreach>
    </update>

</mapper>