<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itmang.mapper.party.DepartmentMapper">
    <!-- 分页查询部门信息 -->
    <select id="pageSearch" resultType="com.itmang.pojo.vo.DepartmentVO">
        SELECT
        d.id,
        d.department_name as departmentName,
        d.father_department_id as fatherDepartmentId,
        fd.department_name as fatherDepartmentName,
        d.create_by as createBy,
        d.create_time as createTime,
        d.update_by as updateBy,
        d.update_time as updateTime,
        d.is_delete as isDelete
        FROM department d
        LEFT JOIN department fd ON d.father_department_id = fd.id AND fd.is_delete = 2
        <where>
            <!-- 部门名称模糊查询 -->
            <if test="departmentName != null and departmentName != ''">
                AND d.department_name LIKE CONCAT('%', #{departmentName}, '%')
            </if>

            <!-- 上级部门ID精确查询 -->
            <if test="fatherDepartmentId != null and fatherDepartmentId != ''">
                AND d.father_department_id = #{fatherDepartmentId}
            </if>

            <!-- 创建者ID查询 -->
            <if test="createBy != null and createBy != ''">
                AND d.create_by LIKE CONCAT('%', #{createBy}, '%')
            </if>

            <!-- 创建时间范围查询 -->
            <if test="createTimeBegin != null">
                AND d.create_time >= #{createTimeBegin}
            </if>
            <if test="createTimeEnd != null">
                AND d.create_time &lt;= #{createTimeEnd}
            </if>

            <!-- 更新者ID查询 -->
            <if test="updateBy != null and updateBy != ''">
                AND d.update_by LIKE CONCAT('%', #{updateBy}, '%')
            </if>

            <!-- 更新时间范围查询 -->
            <if test="updateTimeBegin != null">
                AND d.update_time >= #{updateTimeBegin}
            </if>
            <if test="updateTimeEnd != null">
                AND d.update_time &lt;= #{updateTimeEnd}
            </if>

            <!-- 默认只查询未删除的数据 -->
            AND d.is_delete = 2
        </where>
        ORDER BY d.create_time DESC
    </select>
    <update id="updateBatchById">
        <foreach collection="list" item="item" index="index" separator=";">
            UPDATE department
            SET
            department_name = #{item.departmentName},
            father_department_id = #{item.fatherDepartmentId},
            update_by = #{item.updateBy},
            update_time = #{item.updateTime},
            is_delete = #{item.isDelete}
            WHERE id = #{item.id}
        </foreach>
    </update>

    <select id="selectByParentId" resultType="com.itmang.pojo.entity.Department">
        SELECT
            d.id,
            d.department_name as departmentName,
            d.father_department_id as fatherDepartmentId,
            fd.department_name as fatherDepartmentName,
            d.create_by as createBy,
            d.create_time as createTime,
            d.update_by as updateBy,
            d.update_time as updateTime,
            d.is_delete as isDelete
        FROM department d
        LEFT JOIN department fd ON d.father_department_id = fd.id AND fd.is_delete = 2
        WHERE d.father_department_id = #{parentId}
          AND d.is_delete = 2
        ORDER BY d.create_time DESC
    </select>
    <select id="selectParentName" resultType="java.lang.String">
        SELECT department_name
        from department
        WHERE id=#{parentId}
    </select>


</mapper>